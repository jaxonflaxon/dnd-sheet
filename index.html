<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D 2024 Character Sheet</title>
    <style>
        /* --- STYLING (The Look) --- */
        body { font-family: sans-serif; background-color: #1a1a1a; color: #eee; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* Grid Layout */
        .grid-box { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        /* Sections */
        .section { background: #2a2a2a; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444; }
        h2 { border-bottom: 2px solid #555; padding-bottom: 5px; margin-top: 0; color: #ffa500; }
        
        /* Inputs */
        input, select, textarea { background: #333; border: 1px solid #555; color: white; padding: 5px; border-radius: 4px; width: 100%; box-sizing: border-box; }
        input[type="number"] { text-align: center; font-weight: bold; }
        
        /* Buttons */
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        button { cursor: pointer; padding: 10px 20px; border: none; border-radius: 5px; font-weight: bold; color: white; }
        .btn-short { background-color: #d97706; } /* Orange */
        .btn-long { background-color: #2563eb; }  /* Blue */
        .btn-save { background-color: #16a34a; width: 100%; margin-top: 20px;} /* Green */

        /* Stat Rows - Updated for alignment */
        .stat-row { 
            display: flex; 
            align-items: center; 
            margin-bottom: 10px; 
        }
        
        /* This forces the Name (e.g., Strength) to be exactly 140px wide */
        .stat-row span:first-child {
            width: 140px; 
            font-weight: bold;
            display: inline-block; /* Essential for width to work on spans */
        }

        /* Adds spacing between the input box and the green modifier */
        .stat-row input {
            margin-right: 15px; 
        }

        .mod-box { 
            font-size: 1.2em; 
            font-weight: bold; 
            color: #4ade80; 
            width: 40px; 
            text-align: center; 
        }
        /* --- SKILLS STYLING --- */
        .skill-row { 
            display: flex; 
            align-items: center; 
            padding: 5px 0; 
            border-bottom: 1px solid #333; 
            font-size: 0.9em;
        }
        .skill-name { width: 140px; }
        .skill-total { 
            width: 40px; 
            font-weight: bold; 
            color: #4ade80; 
            text-align: right; 
            margin-right: 15px; 
        }
        .chk-group { display: flex; align-items: center; gap: 5px; margin-right: 10px; }
        .skill-misc { width: 50px !important; text-align: center; }
        .tiny-label { font-size: 0.7em; color: #888; }
    </style>
</head>
<body>

<div class="container">
    <h1>D&D 2024 Character Sheet</h1>
    
    <div class="btn-group">
        <button class="btn-short" onclick="takeRest('short')">Short Rest</button>
        <button class="btn-long" onclick="takeRest('long')">Long Rest</button>
    </div>

    <div class="section">
        <div class="grid-box">
            <div><label>Character Name</label><input type="text" id="charName"></div>
            <div><label>Class & Level</label><input type="text" id="charClass"></div>
        </div>
    </div>

    <div class="section">
        <h2>Vitals</h2>
        <div class="grid-box">
            <div>
                <label>Armor Class (AC)</label>
                <input type="number" id="ac" value="10">
            </div>
            <div>
                <label>Initiative</label>
                <input type="number" id="init" value="0">
            </div>
            
            <div>
                <label>Speed</label>
                <input type="text" id="speed" value="30 ft">
            </div>
            <div>
                <label>Proficiency Bonus</label>
                <input type="number" id="profBonus" value="2">
            </div>

            <div>
                <label>Current / Max HP</label>
                <div style="display:flex; gap:5px;">
                    <input type="number" id="curHp" placeholder="Cur"> <span>/</span> 
                    <input type="number" id="maxHp" placeholder="Max">
                </div>
            </div>
            <div>
                <label>Temporary HP</label>
                <input type="number" id="tempHp" placeholder="0">
            </div>
            
            <div>
                <label>Hit Dice</label>
                 <div style="display:flex; gap:5px;">
                    <input type="number" id="hdCur" placeholder="Cur"> <span>/</span> 
                    <input type="text" id="hdMax" placeholder="Max (e.g. 1d10)">
                </div>
            </div>
        </div>
    </div>

   <div class="section">
        <h2>Attributes</h2>
        
        <div class="stat-row">
            <span>Strength</span>
            <input type="number" id="strScore" value="10" style="width: 60px;" oninput="calcMods()">
            <span class="mod-box" id="strMod">+0</span>
        </div>

        <div class="stat-row">
            <span>Dexterity</span>
            <input type="number" id="dexScore" value="10" style="width: 60px;" oninput="calcMods()">
            <span class="mod-box" id="dexMod">+0</span>
        </div>

        <div class="stat-row">
            <span>Constitution</span>
            <input type="number" id="conScore" value="10" style="width: 60px;" oninput="calcMods()">
            <span class="mod-box" id="conMod">+0</span>
        </div>

        <div class="stat-row">
            <span>Intelligence</span>
            <input type="number" id="intScore" value="10" style="width: 60px;" oninput="calcMods()">
            <span class="mod-box" id="intMod">+0</span>
        </div>

        <div class="stat-row">
            <span>Wisdom</span>
            <input type="number" id="wisScore" value="10" style="width: 60px;" oninput="calcMods()">
            <span class="mod-box" id="wisMod">+0</span>
        </div>

        <div class="stat-row">
            <span>Charisma</span>
            <input type="number" id="chaScore" value="10" style="width: 60px;" oninput="calcMods()">
            <span class="mod-box" id="chaMod">+0</span>
        </div>
    </div>
<div class="section">
        <h2>Skills</h2>
        <div style="display:flex; justify-content:flex-end; padding-bottom:5px; font-size:0.8em; color:#aaa;">
            <span style="margin-right:15px;">Total</span>
            <span style="margin-right:10px;">Prof</span>
            <span style="margin-right:10px;">Exp</span>
            <span>Misc</span>
        </div>
        <div id="skills-container">
            </div>
    </div>
    <button class="btn-save" onclick="saveData()">Save Character</button>
</div>

<script>
    // --- CONFIGURATION ---
    const skillList = [
        { name: "Acrobatics", attr: "dex" },
        { name: "Animal Handling", attr: "wis" },
        { name: "Arcana", attr: "int" },
        { name: "Athletics", attr: "str" },
        { name: "Deception", attr: "cha" },
        { name: "History", attr: "int" },
        { name: "Insight", attr: "wis" },
        { name: "Intimidation", attr: "cha" },
        { name: "Investigation", attr: "int" },
        { name: "Medicine", attr: "wis" },
        { name: "Nature", attr: "int" },
        { name: "Perception", attr: "wis" },
        { name: "Performance", attr: "cha" },
        { name: "Persuasion", attr: "cha" },
        { name: "Religion", attr: "int" },
        { name: "Sleight of Hand", attr: "dex" },
        { name: "Stealth", attr: "dex" },
        { name: "Survival", attr: "wis" }
    ];

    // --- INITIALIZATION ---
    // 1. Build the Skill Rows automatically on load
    function initSkills() {
        const container = document.getElementById('skills-container');
        let html = '';
        
        skillList.forEach(skill => {
            const id = skill.name.replace(/\s+/g, '').toLowerCase(); // e.g. "Animal Handling" -> "animalhandling"
            
            html += `
            <div class="skill-row">
                <div class="skill-name">
                    ${skill.name} <span class="tiny-label">(${skill.attr.toUpperCase()})</span>
                </div>
                <div class="skill-total" id="${id}-total">+0</div>
                
                <div class="chk-group">
                    <input type="checkbox" id="${id}-prof" onchange="calcSkills()">
                </div>

                <div class="chk-group">
                    <input type="checkbox" id="${id}-exp" onchange="calcSkills()">
                </div>

                <input type="number" class="skill-misc" id="${id}-misc" placeholder="0" oninput="calcSkills()">
            </div>
            `;
        });
        
        container.innerHTML = html;
    }

    // --- CALCULATIONS ---

    // 2. Calculate Attributes & Trigger Skill Updates
    function calcMods() {
        const stats = ['str', 'dex', 'con', 'int', 'wis', 'cha']; 
        stats.forEach(stat => {
            const scoreInput = document.getElementById(stat + 'Score');
            if(scoreInput) {
                const mod = Math.floor((scoreInput.value - 10) / 2);
                document.getElementById(stat + 'Mod').innerText = (mod >= 0 ? "+" : "") + mod;
            }
        });
        // After stats change, recalculate skills immediately
        calcSkills();
    }

    // 3. Calculate Skill Totals
    function calcSkills() {
        const profBonus = parseInt(document.getElementById('profBonus').value) || 2;

        skillList.forEach(skill => {
            const id = skill.name.replace(/\s+/g, '').toLowerCase();
            
            // Get Attribute Modifier (e.g., Dex Mod for Acrobatics)
            const attrScore = document.getElementById(skill.attr + 'Score').value;
            const attrMod = Math.floor((attrScore - 10) / 2);

            // Get Checkboxes
            const isProf = document.getElementById(id + '-prof').checked;
            const isExp = document.getElementById(id + '-exp').checked;
            const misc = parseInt(document.getElementById(id + '-misc').value) || 0;

            // Math: Attr + (Prof) + (Exp) + Misc
            let total = attrMod + misc;
            if (isProf) total += profBonus;
            if (isExp) total += profBonus; // Expertise adds PB again

            // Update UI
            document.getElementById(id + '-total').innerText = (total >= 0 ? "+" : "") + total;
        });
    }

    // --- SAVE / LOAD SYSTEM ---
    
    function saveData() {
        const data = {};
        // Save all Inputs
        document.querySelectorAll('input').forEach(input => {
            if(input.type === 'checkbox') data[input.id] = input.checked;
            else data[input.id] = input.value;
        });
        localStorage.setItem('dndSheetData', JSON.stringify(data));
        alert('Character Saved!');
    }

    function loadData() {
        initSkills(); // Build skills first!

        const saved = localStorage.getItem('dndSheetData');
        if (saved) {
            const data = JSON.parse(saved);
            for (const [key, value] of Object.entries(data)) {
                const el = document.getElementById(key);
                if(el) {
                    if(el.type === 'checkbox') el.checked = value;
                    else el.value = value;
                }
            }
        }
        calcMods(); // Recalculate everything
    }

    // Start everything
    loadData();

</script>
</body>
</html>
